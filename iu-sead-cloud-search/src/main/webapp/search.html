<!DOCTYPE html>
<html>
<head>
    <title>IU SEAD CLOUD SEARCH</title>
    <meta name="description" content="A search module for IU SEAD CLOUD">
    <script type="text/javascript" src="js/jquery-min.js"></script>
    <script type="text/javascript" src="js/moment-min.js"></script>
    <script type="text/javascript" src="js/daterangepicker.js"></script>
    <script type="text/javascript" src="js/filter.js" ></script>
    <script type="text/javascript" src="js/jquery.tmpl.js"></script>
    <script type="text/javascript" src="js/search.js"></script>

    <!--<link rel="stylesheet" media="all" href="css/bootstrap.min.css">-->
    <link rel="stylesheet" media="all" href="css/search.css">
    <link rel="stylesheet" media="all" href="css/daterangepicker.css">
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
</head>
<body>

<header id="masthead" class="site-header clearfix">
    <div id="header-text-nav-wrap" class="clearfix">
        <!-- #header-logo-image -->
        <div id="header-left-section">
            <div id="header-logo-image">
                <a href="#" title="SEAD" rel="home"><img
                        src="http://sead-data.net/wp-content/uploads/2014/06/logo.png"
                        alt="SEAD"></a>
            </div>
        </div>
    </div>
</header>

<div id="nav">
    <h4 style="color:#3b5998">Search & Filter By Below Options: </h4>
    <div id="filter"></div>
</div>

<div id="middle"></div>

<div id="section">
    <h1 style="color:#3b5998"><u>IU SEAD Cloud Search</u></h1>
    <h3 style="color:#3b5998">Search Results:</h3>
    <table id="CRUDthisTable" class="mediumTable"></table>
</div>

<div id="footer">
    <p>SEAD is funded by the National Science Foundation under cooperative agreement #OCI0940824.</p>
</div>
</body>

<script type="text/javascript">
      function sendToServer(data){
		var apiprefix = "./ro";
		if (data.hasOwnProperty('creator_name')){
			search_creator = data.creator_name.values[0].value;
		}else{
			search_creator = "";
		}if (data.hasOwnProperty('search_content')){
			search_string = data.search_content.values[0].value;
		}else{
			search_string = "";
		}if (data.hasOwnProperty('title')){
			search_title = data.title.values[0].value;
		}else{
			search_title = "";
		}if (data.hasOwnProperty('date_range')){
			search_date_range = data.date_range.values[0].value;
			search_start_date = search_date_range.split("-")[0].trim();
			search_end_date = search_date_range.split("-")[1].trim();
		}else{
			search_date_range = "";
			search_start_date = "";
			search_end_date = "";
		}

		var search_json = {"Creator":search_creator, "Start Date":search_start_date,
							"End Date":search_end_date, "Search String": search_string,
							"Title":search_title};
		var myData=JSON.stringify(search_json);
		var request = $.ajax({
						url: apiprefix + "/researchobjects",
						type: "post",
						data: myData,
						cache: false,
						dataType: 'text',
						contentType : 'application/json'
						});

		request.done(function (response){
					console.log("Response from server: " + response);

		new_arr = JSON.parse(response);
		$("#CRUDthisTable").empty();

		if(response != "[]"){
			var new_ros = [];

			for(var i = 0; i < new_arr.length; i++) {
				var creator= new_arr[i].Creator;
				var abstract= new_arr[i].Abstract;
				var title= new_arr[i].Title;
				var identifier= new_arr[i].Identifier;
				var pub_date= new_arr[i]["Publication Date"];
				var create_date= new_arr[i]["Creation Date"];
				var doi= new_arr[i].DOI;

				new_ros.push( { "Creator":creator, "Abstract": abstract, "Title": title, "Identifier": identifier,
						"PublicationDate":pub_date, "CreationDate":create_date,"DOI":doi});

				}
				$("#viewRowTemplate").tmpl(new_ros).appendTo("#CRUDthisTable");
		}else{
	$("#viewRowTemplateNull").tmpl(new_ros).appendTo("#CRUDthisTable");
	}
	});
}
	var repoOptions = [
			{name: 'IU SEAD CLOUD', value: 'sda', selected: true} //selected on display
		   ],

		options = {
			title: 'SEAD Search Filter',
			dateFormat: this.dateFormat,
			searchClickedCallback: sendToServer,
			filterParameters: [
				{type: 'text', attributeName: 'search_content', name: 'Search Content', placeholder: 'search by any text'},
				{type: 'text', attributeName: 'creator_name', name: 'Creator Name', placeholder: 'type creator name'},
				{type: 'date-range', attributeName: 'date_range', name: 'Date Range'},
				{type: 'text', attributeName: 'title', name: 'Title', placeholder: 'type title'},
			]
		};
	$('#filter').bootstrapFilter(options);
</script>
<script id="viewRowTemplate" type="text/x-jquery-tmpl">
	<ul>
		<li>
			<b>Creator: </b>{{html Creator}}</br>
			<b>Abstract: </b>{{html Abstract}}</br>
			<b>Title: </b>{{html Title}}</br>
			<b>Publication Date: </b>{{html PublicationDate}}</br>
			<b>Creation Date: </b>{{html CreationDate}}</br>
			<b>DOI: </b><a href="{{html DOI}}">{{html DOI}}</a>
		</li>
	</ul>
	</br>
</script>
<script id="viewRowTemplateNull" type="text/x-jquery-tmpl">
	<ul>
		<li style="width:600px;color:red;">
			No Results Found.
		</li>
	</ul>
	</br>
</script>
</html>