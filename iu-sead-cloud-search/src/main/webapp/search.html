<!DOCTYPE html>
<html>
<head>
    <title>IU SEAD CLOUD SEARCH</title>
    <meta name="description" content="A search module for IU SEAD CLOUD">
    <script type="text/javascript" src="js/jquery-min.js"></script>
    <script type="text/javascript" src="js/moment-min.js"></script>
    <script type="text/javascript" src="js/daterangepicker.js"></script>
    <script type="text/javascript" src="js/filter.js" ></script>
    <script type="text/javascript" src="js/jquery.tmpl.js"></script>
    <script type="text/javascript" src="js/search.js"></script>

    <!--<link rel="stylesheet" media="all" href="css/bootstrap.min.css">-->
    <link rel="stylesheet" media="all" href="css/search.css">
    <link rel="stylesheet" media="all" href="css/daterangepicker.css">
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
</head>
<body>

<div style="display : inline-block; padding: 10px 20px 5px 0px;width:100%;">
    <div align="left">
        <span class="helper"></span>
        <img align="left" style="width: 30%;height: 30%;padding:0px 0px 10px 50px;"" src="http://brand.iu.edu/img/signatures/indiana-university/indiana-university">
    </div>
    <div align="right">
        <span class="helper"></span>
        <img align="right" style="width: 35%;padding:30px 10px 0px 0px;" src="http://sead-data.net/wp-content/uploads/2014/06/logo.png">
    </div>
</div>
<div>
    <div style="float: right; font-size:14px;padding:0px 45px 0px 0px;">
        <a href="http://seadva.d2i.indiana.edu:8081/landing-page/home.html">IU SEAD Cloud</a>
    </div>
    <div style="float: right; font-size:14px;padding:0px 20px 0px 0px;"><a href="#"> | </a></div>
    <div style="float: right; font-size:14px;padding:0px 20px 0px 0px;">
        <a href="http://sead-data.net/">SEAD</a>
    </div>
</div>
<div style="width:100%;">
    <div id="nav">
        <h4 style="color:#3b5998">Search & Filter By Below Options: </h4>
        <div id="filter"></div>
    </div>
    <div id="middle"></div>

    <div id="section">
        <h1 style="color:#3b5998;padding:10px 0px 0px 0px;""><u>IU SEAD Cloud Search</u></h1>
        <h3 style="color:#3b5998">Search Results:</h3>
        <table id="CRUDthisTable" class="mediumTable"></table>
    </div>
</div>

<div id="footer" style="width:100%">
    <p>SEAD is funded by the National Science Foundation under cooperative agreement #OCI0940824.</p>
</div>
</body>

<script type="text/javascript">
      function sendToServer(data){
		var apiprefix = "./ro";
		if (data.hasOwnProperty('creator_name')){
			search_creator = data.creator_name.values[0].value;
		}else{
			search_creator = "";
		}if (data.hasOwnProperty('search_content')){
			search_string = data.search_content.values[0].value;
		}else{
			search_string = "";
		}if (data.hasOwnProperty('title')){
			search_title = data.title.values[0].value;
		}else{
			search_title = "";
		}if (data.hasOwnProperty('date_range')){
			search_date_range = data.date_range.values[0].value;
			search_start_date = search_date_range.split("-")[0].trim();
			search_end_date = search_date_range.split("-")[1].trim();
		}else{
			search_date_range = "";
			search_start_date = "";
			search_end_date = "";
		}

		var search_json = {"Creator":search_creator, "Start Date":search_start_date,
							"End Date":search_end_date, "Search String": search_string,
							"Title":search_title};
		var myData=JSON.stringify(search_json);
		var request = $.ajax({
						url: apiprefix + "/researchobjects",
						type: "post",
						data: myData,
						cache: false,
						dataType: 'text',
						contentType : 'application/json'
						});

		request.done(function (response){
					console.log("Response from server: " + response);

		new_arr = JSON.parse(response);
		$("#CRUDthisTable").empty();

		if(response != "[]"){
			var new_ros = [];

			for(var i = 0; i < new_arr.length; i++) {

				var creator= new_arr[i].Creator;
				var new_creator = "";
				if($.isArray(creator)) {
					for (var c=0; c < creator.length; c++){
						if (c=creator.length-1){
							new_creator += creator[c];
						}else{
							new_creator += creator[c] + ",\n";
						}
					}
				} else {
					new_creator = creator;
				}

				var abstract= new_arr[i].Abstract;
				var new_abstract = "";
				if($.isArray(abstract)) {
					for (var a=0; c < abstract.length; a++){
						if (a=abstract.length-1){
							new_abstract += abstract[a];
						}else{
							new_abstract += abstract[a] + ",\n";
						}
					}
				} else {
					new_abstract = abstract;
				}
				var title= new_arr[i].Title;
				var identifier= new_arr[i].Identifier;
				var pub_date= new_arr[i]["Publication Date"];
				var create_date= new_arr[i]["Creation Date"];
				var doi= new_arr[i].DOI;

				new_ros.push( { "Creator":new_creator, "Abstract": new_abstract, "Title": title, "Identifier": identifier,
						"PublicationDate":pub_date, "CreationDate":create_date,"DOI":doi});

				}
				$("#viewRowTemplate").tmpl(new_ros).appendTo("#CRUDthisTable");
		}else{
	$("#viewRowTemplateNull").tmpl(new_ros).appendTo("#CRUDthisTable");
	}
	});
}
	var repoOptions = [
			{name: 'IU SEAD CLOUD', value: 'sda', selected: true} //selected on display
		   ],

		options = {
			title: 'SEAD Search Filter',
			dateFormat: this.dateFormat,
			searchClickedCallback: sendToServer,
			filterParameters: [
				{type: 'text', attributeName: 'search_content', name: 'Search Content', placeholder: 'search by any text', id: 'IFRI', autocomplete: 'on'},
				{type: 'text', attributeName: 'creator_name', name: 'Creator Name', placeholder: 'type creator name', id: 'Leslie', autocomplete: 'on'},
				{type: 'date-range', attributeName: 'date_range', name: 'Date Range'},
				{type: 'text', attributeName: 'title', name: 'Title', placeholder: 'type title', id: 'Bedrock Strength Measurements', autocomplete: 'on'},
			]
		};
	$('#filter').bootstrapFilter(options);
</script>
<script id="viewRowTemplate" type="text/x-jquery-tmpl">
	<ul>
		<li>
			<b>Creator: </b>{{html Creator}}</br>
			<b>Abstract: </b>{{html Abstract}}</br>
			<b>Title: </b>{{html Title}}</br>
			<b>Publication Date: </b>{{html PublicationDate}}</br>
			<b>Creation Date: </b>{{html CreationDate}}</br>
			<b>DOI: </b><a href="{{html DOI}}">{{html DOI}}</a>
		</li>
	</ul>
	</br>
</script>
<script id="viewRowTemplateNull" type="text/x-jquery-tmpl">
	<ul>
		<li style="width:600px;color:red;">
			No Results Found.
		</li>
	</ul>
	</br>
</script>
</html>